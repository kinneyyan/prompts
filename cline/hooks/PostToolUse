#!/usr/bin/env bash

input=$(cat)

workspace_root=$(echo "$input" | jq -r '.workspaceRoots[0]')
tool_name=$(echo "$input" | jq -r '.postToolUse.toolName')

if [ "$tool_name" = "write_to_file" ] || [ "$tool_name" = "replace_in_file" ]; then
    file_path=$(echo "$input" | jq -r '.postToolUse.parameters.path')
    # echo "Tool: $tool_name"
    echo "Path: $file_path"
    # æ£€æŸ¥ file_path æ˜¯å¦æœ‰å€¼ï¼Œå¹¶ä¸”æ˜¯ .js, .jsx, .ts, .tsx, .css, .scss, .less æ–‡ä»¶
    if [ -n "$file_path" ] && [ "$file_path" != "null" ]; then
        if [[ "$file_path" =~ \.(js|jsx|ts|tsx|css|scss|less)$ ]]; then
            cd $workspace_root
            if command -v prettier &> /dev/null || [ -f "node_modules/.bin/prettier" ]; then
                echo "npx prettier --write $file_path"
                # result=$(npx eslint "$file_path" --fix --quiet)
                result=$(npx prettier --write $file_path)
                if [ $? -eq 0 ]; then
                  echo "âœ… success"
                else
                  echo "âŒ failed" >&2
                fi
            else
                echo "ðŸ¦‰ prettier not found, skipped"
            fi
        else
            echo "ðŸ¦‰ unsupported file type, skipped"
        fi
    fi
fi